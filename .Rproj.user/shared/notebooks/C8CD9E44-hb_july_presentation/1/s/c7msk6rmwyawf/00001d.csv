"0","# format date"
"0","air$DATE<-ymd(air$date) # change how R interprets Date to be a date"
"0","air$Year<-year(air$DATE)"
"0",""
"0","# Use water year starting June 1st"
"0","w.year <- as.numeric(format(air$DATE, ""%Y""))"
"0","june.july.sept <- as.numeric(format(air$DATE, ""%m"")) < 6"
"0","w.year[june.july.sept] <- w.year[june.july.sept] - 1"
"0","air$wyear<-w.year # add water year as a column to precip dataset"
"0",""
"0","#subset to just HQ"
"0","hq<-air[air$STA==""HQ"",]"
"0",""
"0","# make sure you are only using complete years for the record"
"0","pre.obs<-as.data.frame(table(hq$STA , hq$wyear))"
"0","pre.obs[pre.obs$Freq<360, ""Use""]<-""incomplete wyear"" # incomplete is < 360 days"
"0","pre.obs[is.na(pre.obs$Use),""Use""]<-""complete"""
"0",""
"0","# match by water year-station, only use 'complete' years"
"0","pre.obs$wys<-paste(pre.obs$Var2, pre.obs$Var1)"
"0","hq$wys<-paste(hq$wyear, hq$STA)"
"0","hq$Use<-pre.obs$Use[match(hq$wys, pre.obs$wys)]"
"0","hq.complete<-hq[hq$Use==""complete"",]"
"0",""
"0","# aggregate to annual average"
"0","hqa<-aggregate(list(MAX=hq.complete$MAX, MIN=hq.complete$MIN, AVE=hq.complete$AVE), by=list(wyear=hq.complete$wyear), FUN=""mean"")"
"0",""
"0","hq_g<-gather(hqa, ""type"",""value"", 2:4)"
"0",""
"0","## calculate difference between recent 6 years compared to first 6 years"
"0","magmin<-format(round(mean(tail(hqa$MIN))-mean(head(hqa$MIN)), digits=1), nsmall = 1)"
"0","magave<-format(round(mean(tail(hqa$AVE))-mean(head(hqa$AVE)), digits=1), nsmall = 1)"
"0","magmax<-format(round(mean(tail(hqa$MAX))-mean(head(hqa$MAX)), digits=1), nsmall = 1)"
"0",""
"0","# order temp types"
"0","hq_g$type<-factor(hq_g$type, levels=c(""MAX"",""AVE"",""MIN""))"
