"0",""
"0","## Chapter 2.2"
"0","####################################################"
"0",""
"0","# read in preciptation data"
"0",""
"0","# Package ID: knb-lter-hbr.14.14 Cataloging System:https://pasta.edirepository.org."
"0","# Data set title: Hubbard Brook Experimental Forest: Total Daily Precipitation by Watershed, 1956 - present."
"0","inUrl1  <- ""https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/14/14/c606bfe2f2deb3fa3eabf692ae15f02d"" "
"0","infile1 <- tempfile()"
"0","try(download.file(inUrl1,infile1,method=""curl""))"
"1","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
"
"1","                                 Dload  Upload   Total   Spent    Left  Speed
"
"1","  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0 36 3598k   36 1295k    0     0   768k      0  0:00:04  0:00:01  0:00:03  768k100 3598k  100 3598k    0     0  1651k      0  0:00:02  0:00:02 --:--:-- 1652k
"
"0","if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method=""auto"")"
"0",""
"0","dt2 <-read.csv(infile1,header=F "
"0","               ,skip=1"
"0","               ,sep="",""  "
"0","               , col.names=c("
"0","                 ""DATE"",     "
"0","                 ""watershed"",     "
"0","                 ""Precip""    ), check.names=TRUE)"
"0",""
"0","unlink(infile1)"
"0",""
"0","# conduct data formatting"
"0","str(dt2)"
"1","'data.frame':	"
"1",""
"1","183939"
"1",""
"1"," obs. of  "
"1",""
"1","3"
"1",""
"1"," variable"
"1",""
"1","s"
"1",""
"1",":"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","DATE     "
"1",""
"1",":"
"1"," chr  "
"1",""
"1","""1956-01-01"" ""1956-01-02"" ""1956-01-03"" ""1956-01-04"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","watershed"
"1",""
"1",":"
"1"," chr  "
"1",""
"1","""W1"" ""W1"" ""W1"" ""W1"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","Precip   "
"1",""
"1",":"
"1"," num  "
"1",""
"1","0 0 8.6 0 0 0 0 18.8 8.1 6.3"
"1",""
"1"," ..."
"1",""
"1","
"
"0","# We have a data column, but its not formatted as a date"
"0","dt2$DATE<-ymd(dt2$DATE) # change how R interprets Date to be a date"
"0","dt2$Year<-year(dt2$DATE)"
"0",""
"0","# add in water year"
"0","w.year <- as.numeric(format(dt2$DATE, ""%Y""))"
"0","june.july.sept <- as.numeric(format(dt2$DATE, ""%m"")) < 6"
"0","w.year[june.july.sept] <- w.year[june.july.sept] - 1"
"0",""
"0","dt2$wyear<-w.year # add water year as a column to precip dataset"
"0",""
"0","# add in water year-station"
"0","dt2$wys<-paste(dt2$wyear, dt2$watershed)"
"0",""
"0",""
"0","# make sure you are only using complete years for the record"
"0","pre.obs<-as.data.frame(table(dt2$watershed , dt2$wyear))"
"0","pre.obs$wys<- paste(pre.obs$Var2, pre.obs$Var1)"
"0","pre.obs[pre.obs$Freq<350, ""Use""]<-""incomplete wyear"" # complete is 350+ days"
"0","pre.obs[is.na(pre.obs$Use),""Use""]<-""complete"""
"0","#head(pre.obs, 11)"
"0",""
"0","dt2$Use<-pre.obs$Use[match(dt2$wys, pre.obs$wys)]"
"0","dt2.complete<-dt2[dt2$Use==""complete"",]"
"0",""
"0","# get annual sums"
"0","annpre<-aggregate(list(Precip=dt2.complete$Precip),"
"0","      by=list(WS=dt2.complete$watershed, wyear=dt2.complete$wyear), FUN=""sum"")"
"0",""
"0","g2<-ggplot(annpre, aes(x=wyear, y=Precip, col=WS))+"
"0","  geom_point()+geom_line()+"
"0","  ylab(""Precip (mm)"")+xlab(""Water year (June 1)"")+"
"0","  theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())"
"0","p2<-ggplotly(g2)"
"0","p2"
