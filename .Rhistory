# view the dataset, 182,000 rows
str(dt1)
# Notice that WS is numeric, and we want the watersheds to be factors
dt1$WS<-as.factor(dt1$WS)
# Provide columns interpreted as a Date by R
dt1$DATE<-ymd(dt1$DATE) # change how R interprets Date to be a date
dt1$Year<-year(dt1$DATE)   #add a column for 'year' from date
dt1$doy<-yday(dt1$DATE) # add day of year
head(dt1)
# Quick summary of the dataset
table( dt1$WS, dt1$Year) # view how many Watersheds, and # of observations
num_days_WS<-as.data.frame(table(dt1$WS, dt1$Year))
ggplot(num_days_WS, aes(x=Var1, y=Freq, fill=Var2))+
geom_bar(stat="identity", col="black")+theme_classic()
# add in water year
w.year <- as.numeric(format(dt1$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt1$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt1$wyear<-w.year
# add in 'water year station'.
dt1$wys<-paste(dt1$wyear, dt1$WS)
head(dt1)
# make sure you are only using complete years for the record
str.obs<-as.data.frame(table(dt1$WS, dt1$wyear))
str.obs$wys<- paste(str.obs$Var2, str.obs$Var1)
str.obs[str.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
str.obs[is.na(str.obs$Use),"Use"]<-"complete"
head(str.obs, 50)
dt1$Use<-str.obs$Use[match(dt1$wys, str.obs$wys)]
dt1.complete<-dt1[dt1$Use=="complete",]
dt1.complete
# calculate the annual sum of streamflow measurements
annstr<-aggregate(list(Streamflow=dt1.complete$Streamflow), by=list(WS=dt1.complete$WS, wyear=dt1.complete$wyear), FUN="sum")
# this makes it nicer for working with other HB datasets
annstr$WS<-sub("^","W",annstr$WS)
head(annstr)
#  Data currently go to 22
g1<-ggplot(annstr, aes(x=wyear, y=Streamflow, col=WS))+
geom_point()+geom_line()+
ylab("Steamflow (mm)")+xlab("Water year (June 1)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g1
## Chapter 2.2
####################################################
# read in preciptation data
# Package ID: knb-lter-hbr.14.14 Cataloging System:https://pasta.edirepository.org.
# Data set title: Hubbard Brook Experimental Forest: Total Daily Precipitation by Watershed, 1956 - present.
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/14/14/c606bfe2f2deb3fa3eabf692ae15f02d"
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
dt2 <-read.csv(infile1,header=F
,skip=1
,sep=","
, col.names=c(
"DATE",
"watershed",
"Precip"    ), check.names=TRUE)
unlink(infile1)
# conduct data formatting
str(dt2)
# We have a data column, but its not formatted as a date
dt2$DATE<-ymd(dt2$DATE) # change how R interprets Date to be a date
dt2$Year<-year(dt2$DATE)
# add in water year
w.year <- as.numeric(format(dt2$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt2$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt2$wyear<-w.year # add water year as a column to precip dataset
# add in water year-station
dt2$wys<-paste(dt2$wyear, dt2$watershed)
head(dt2)
# make sure you are only using complete years for the record
pre.obs<-as.data.frame(table(dt2$watershed , dt2$wyear))
pre.obs$wys<- paste(pre.obs$Var2, pre.obs$Var1)
pre.obs[pre.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
pre.obs[is.na(pre.obs$Use),"Use"]<-"complete"
head(pre.obs, 50)
dt2$Use<-pre.obs$Use[match(dt2$wys, pre.obs$wys)]
dt2.complete<-dt2[dt2$Use=="complete",]
# get annual sums
annpre<-aggregate(list(Precip=dt2.complete$Precip), by=list(WS=dt2.complete$watershed, wyear=dt2.complete$wyear), FUN="sum")
head(annpre)
g2<-ggplot(annpre, aes(x=wyear, y=Precip, col=WS))+
geom_point()+geom_line()+
ylab("Precip (mm)")+xlab("Water year (June 1)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g2
## Chapter 2.3
####################################################
# calculate Actual EvapoTranspiration (AET) #  Precip - Streamflow = AET
### give the watersheds and years a unique ID. watershed-year, wsy
annstr$wsy<-paste(annstr$WS, annstr$wyear)
annpre$wsy<-paste(annpre$WS, annpre$wyear)
# bring in precip data to streamflow object
annstr$Precip<-annpre$Precip[match(annstr$wsy, annpre$wsy)]
# calculate AET, assuming no change in storage
annstr$AET<-annstr$Precip - annstr$Streamflow
g3<-ggplot(annstr, aes(x=wyear, y=AET, col=WS))+
geom_point()+geom_line()+
ylab("AET (mm)")+xlab("Water year (June 1st)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g3
## create gg plotly objects
p1<-ggplotly(g1)
p2<-ggplotly(g2)
p3<-ggplotly(g3)
plotfinal<-subplot(p1, p2, p3, nrows=3,
shareX = T, shareY = T)
plotfinal
#htmlwidgets::saveWidget(as_widget(plotfinal), "hwChapter/hydrology_2_precip_stream_AET.html")
## Chapter 2.4
####################################################
# # read in air temperature data,  compare AET with Average annual air temp
# Package ID: knb-lter-hbr.59.10 Cataloging System:https://pasta.edirepository.org.
# Data set title: Hubbard Brook Experimental Forest: Daily Temperature Record, 1955 - present.
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/59/10/9723086870f14b48409869f6c06d6aa8"
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
dt3 <-read.csv(infile1,header=F
,skip=1
,sep=","
, col.names=c(
"date",
"STA",
"MAX",
"MIN",
"AVE",
"Flag"    ), check.names=TRUE)
unlink(infile1)
head(dt3)
# We have a data column, but its not formatted as a date
dt3$DATE<-ymd(dt3$date) # change how R interprets Date to be a date
dt3$Year<-year(dt3$DATE)
# add in water year
w.year <- as.numeric(format(dt3$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt3$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt3$wyear<-w.year # add water year as a column to precip dataset
dt3$month<-month(dt3$date)
# add in water year-station
dt3$wys<-paste(dt3$wyear, dt3$STA)
head(dt3)
# make sure you are only using complete years for the record
pre.obs<-as.data.frame(table(dt3$STA , dt3$wyear))
pre.obs$wys<- paste(pre.obs$Var2, pre.obs$Var1)
pre.obs[pre.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
pre.obs[is.na(pre.obs$Use),"Use"]<-"complete"
head(pre.obs, 50)
dt3$Use<-pre.obs$Use[match(dt3$wys, pre.obs$wys)]
dt3.complete<-dt3[dt3$Use=="complete",]
head(dt3)
# get annual averages of air
growseas<-dt3.complete[dt3.complete$month >="6" & dt3.complete$month <=9 ,]
annairgrow<-aggregate(list(avtemp=growseas$AVE), by=list( wyear=growseas$wyear), FUN="mean")
head(annairgrow)
# #visualize to become familiar with data
# ggplot(annairgrow, aes(x=wyear, y=avtemp))+
#   geom_point()+geom_line()+
#   ylab("Growing season air temperature (C)")+xlab("Water year (June 1st)")+
#   theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
# view trend from 1995-2010 of growing season temp and AET
### bring in av temp to annstr
annstr$avtemp<-annairgrow$avtemp[match(annstr$wyear, annairgrow$wyear)]
#subset to 1995-2010
temp_aet<-annstr[annstr$wyear >= "1995" & annstr$wyear <="2010" ,]
ch2<-ggplot(temp_aet, aes(x=avtemp, y=AET, col=WS))+geom_point()+
geom_smooth(method="lm", se=F)+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
xlab("Average growing season temperature (C) June 1 - Sep 30")+
ylab("Actual Evapotranspiration")
pch2<-ggplotly(ch2)
pch2
#htmlwidgets::saveWidget(as_widget(pch2), "hwChapter/hydrology_2_temp_aet.html")
## Chapter 2.5
####################################################
# Forest cutting to increase water supply?
# WS5 clearcut in whole tree harvest 1984-1985.
head(annstr)
# separate out WS5
WS5<-annstr[annstr$WS=="W5",]
head(WS5)
# subset years for periof of time in question
harvest<-WS5[WS5$wyear >= "1970" & WS5$wyear <="1994" ,]
head(harvest)
# Use precip and stream discharge to evaluate effect on water yield and AET for 1983 (pre) - 1986 (post clear cut)
harvest$wyear<-as.integer(harvest$wyear)
gharv<-ggplot(harvest, aes(x=wyear, y=AET))+geom_point()+
geom_vline(xintercept=1983, linetype="dashed", col="red")+
geom_vline(xintercept=1985, linetype="solid", col="red")+
geom_line()+scale_x_continuous(limits = c(1970, 1994), breaks = seq(1970, 1994, 5))+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
xlab("Water year (June 1)")+
ylab("Actual Evapotranspiration")+
ggtitle("Hubbard Brook Watershed 5: Whole tree harvest 1983-1985")
gharv
# # a different look at the relationship
# ggplot(harvest, aes(x=Streamflow, y=Precip, col=wyear))+geom_point()+
#   theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
#   xlab("Streamflow (mm)")+
#   ylab("Precipitation (mm)")+
#   xlim(0,2000)+ylim(0,2000)
#pharv<-ggplotly(gharv)
#pharv
#htmlwidgets::saveWidget(as_widget(pharv), "hwChapter/hydrology_2_WS5_harvest.html")
gharv
ch2
####### HB online book HW chapter
####################################################
library(lubridate) # for handling date-times
library(ggplot2) # for visualizing
library(tidyr) # for data formatting
library(dplyr) # for data formatting
library(plotly)# for making interactive graphs
## Chapter 2.1
####################################################
# read in streamflow data
# Package ID: knb-lter-hbr.2.11 Cataloging System:https://pasta.edirepository.org.
# Data set title: Hubbard Brook Experimental Forest: Daily Streamflow by Watershed, 1956 - present.
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/2/11/1254d17cbd381556c05afa740d380e78"
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
dt1 <-read.csv(infile1,header=F
,skip=1
,sep=","
,quot='"'
, col.names=c(
"DATE",
"WS",
"Streamflow",
"Flag"    ), check.names=TRUE)
unlink(infile1)
# view the dataset, 182,000 rows
str(dt1)
# Notice that WS is numeric, and we want the watersheds to be factors
dt1$WS<-as.factor(dt1$WS)
# Provide columns interpreted as a Date by R
dt1$DATE<-ymd(dt1$DATE) # change how R interprets Date to be a date
dt1$Year<-year(dt1$DATE)   #add a column for 'year' from date
dt1$doy<-yday(dt1$DATE) # add day of year
head(dt1)
# Quick summary of the dataset
table( dt1$WS, dt1$Year) # view how many Watersheds, and # of observations
num_days_WS<-as.data.frame(table(dt1$WS, dt1$Year))
ggplot(num_days_WS, aes(x=Var1, y=Freq, fill=Var2))+
geom_bar(stat="identity", col="black")+theme_classic()
# add in water year
w.year <- as.numeric(format(dt1$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt1$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt1$wyear<-w.year
# add in 'water year station'.
dt1$wys<-paste(dt1$wyear, dt1$WS)
head(dt1)
# make sure you are only using complete years for the record
str.obs<-as.data.frame(table(dt1$WS, dt1$wyear))
str.obs$wys<- paste(str.obs$Var2, str.obs$Var1)
str.obs[str.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
str.obs[is.na(str.obs$Use),"Use"]<-"complete"
head(str.obs, 50)
dt1$Use<-str.obs$Use[match(dt1$wys, str.obs$wys)]
dt1.complete<-dt1[dt1$Use=="complete",]
dt1.complete
# calculate the annual sum of streamflow measurements
annstr<-aggregate(list(Streamflow=dt1.complete$Streamflow), by=list(WS=dt1.complete$WS, wyear=dt1.complete$wyear), FUN="sum")
# this makes it nicer for working with other HB datasets
annstr$WS<-sub("^","W",annstr$WS)
head(annstr)
#  Data currently go to 22
g1<-ggplot(annstr, aes(x=wyear, y=Streamflow, col=WS))+
geom_point()+geom_line()+
ylab("Steamflow (mm)")+xlab("Water year (June 1)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g1
## Chapter 2.2
####################################################
# read in preciptation data
# Package ID: knb-lter-hbr.14.14 Cataloging System:https://pasta.edirepository.org.
# Data set title: Hubbard Brook Experimental Forest: Total Daily Precipitation by Watershed, 1956 - present.
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/14/14/c606bfe2f2deb3fa3eabf692ae15f02d"
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
dt2 <-read.csv(infile1,header=F
,skip=1
,sep=","
, col.names=c(
"DATE",
"watershed",
"Precip"    ), check.names=TRUE)
unlink(infile1)
# conduct data formatting
str(dt2)
# We have a data column, but its not formatted as a date
dt2$DATE<-ymd(dt2$DATE) # change how R interprets Date to be a date
dt2$Year<-year(dt2$DATE)
# add in water year
w.year <- as.numeric(format(dt2$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt2$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt2$wyear<-w.year # add water year as a column to precip dataset
# add in water year-station
dt2$wys<-paste(dt2$wyear, dt2$watershed)
head(dt2)
# make sure you are only using complete years for the record
pre.obs<-as.data.frame(table(dt2$watershed , dt2$wyear))
pre.obs$wys<- paste(pre.obs$Var2, pre.obs$Var1)
pre.obs[pre.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
pre.obs[is.na(pre.obs$Use),"Use"]<-"complete"
head(pre.obs, 50)
dt2$Use<-pre.obs$Use[match(dt2$wys, pre.obs$wys)]
dt2.complete<-dt2[dt2$Use=="complete",]
# get annual sums
annpre<-aggregate(list(Precip=dt2.complete$Precip), by=list(WS=dt2.complete$watershed, wyear=dt2.complete$wyear), FUN="sum")
head(annpre)
g2<-ggplot(annpre, aes(x=wyear, y=Precip, col=WS))+
geom_point()+geom_line()+
ylab("Precip (mm)")+xlab("Water year (June 1)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g2
## Chapter 2.3
####################################################
# calculate Actual EvapoTranspiration (AET) #  Precip - Streamflow = AET
### give the watersheds and years a unique ID. watershed-year, wsy
annstr$wsy<-paste(annstr$WS, annstr$wyear)
annpre$wsy<-paste(annpre$WS, annpre$wyear)
# bring in precip data to streamflow object
annstr$Precip<-annpre$Precip[match(annstr$wsy, annpre$wsy)]
# calculate AET, assuming no change in storage
annstr$AET<-annstr$Precip - annstr$Streamflow
g3<-ggplot(annstr, aes(x=wyear, y=AET, col=WS))+
geom_point()+geom_line()+
ylab("AET (mm)")+xlab("Water year (June 1st)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#g3
## create gg plotly objects
p1<-ggplotly(g1)
p2<-ggplotly(g2)
p3<-ggplotly(g3)
plotfinal<-subplot(p1, p2, p3, nrows=3,
shareX = T, shareY = T)
plotfinal
#htmlwidgets::saveWidget(as_widget(plotfinal), "hwChapter/hydrology_2_precip_stream_AET.html")
## Chapter 2.4
####################################################
# # read in air temperature data,  compare AET with Average annual air temp
# Package ID: knb-lter-hbr.59.10 Cataloging System:https://pasta.edirepository.org.
# Data set title: Hubbard Brook Experimental Forest: Daily Temperature Record, 1955 - present.
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-hbr/59/10/9723086870f14b48409869f6c06d6aa8"
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
dt3 <-read.csv(infile1,header=F
,skip=1
,sep=","
, col.names=c(
"date",
"STA",
"MAX",
"MIN",
"AVE",
"Flag"    ), check.names=TRUE)
unlink(infile1)
head(dt3)
# We have a data column, but its not formatted as a date
dt3$DATE<-ymd(dt3$date) # change how R interprets Date to be a date
dt3$Year<-year(dt3$DATE)
# add in water year
w.year <- as.numeric(format(dt3$DATE, "%Y"))
june.july.sept <- as.numeric(format(dt3$DATE, "%m")) < 6
w.year[june.july.sept] <- w.year[june.july.sept] - 1
dt3$wyear<-w.year # add water year as a column to precip dataset
dt3$month<-month(dt3$date)
# add in water year-station
dt3$wys<-paste(dt3$wyear, dt3$STA)
head(dt3)
# make sure you are only using complete years for the record
pre.obs<-as.data.frame(table(dt3$STA , dt3$wyear))
pre.obs$wys<- paste(pre.obs$Var2, pre.obs$Var1)
pre.obs[pre.obs$Freq<350, "Use"]<-"incomplete wyear" # complete is 350 or more days
pre.obs[is.na(pre.obs$Use),"Use"]<-"complete"
head(pre.obs, 50)
dt3$Use<-pre.obs$Use[match(dt3$wys, pre.obs$wys)]
dt3.complete<-dt3[dt3$Use=="complete",]
head(dt3)
# get annual averages of air
growseas<-dt3.complete[dt3.complete$month >="6" & dt3.complete$month <=9 ,]
annairgrow<-aggregate(list(avtemp=growseas$AVE), by=list( wyear=growseas$wyear), FUN="mean")
head(annairgrow)
# #visualize to become familiar with data
# ggplot(annairgrow, aes(x=wyear, y=avtemp))+
#   geom_point()+geom_line()+
#   ylab("Growing season air temperature (C)")+xlab("Water year (June 1st)")+
#   theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
# view trend from 1995-2010 of growing season temp and AET
### bring in av temp to annstr
annstr$avtemp<-annairgrow$avtemp[match(annstr$wyear, annairgrow$wyear)]
#subset to 1995-2010
temp_aet<-annstr[annstr$wyear >= "1995" & annstr$wyear <="2010" ,]
ch2<-ggplot(temp_aet, aes(x=avtemp, y=AET, col=WS))+geom_point()+
geom_smooth(method="lm", se=F)+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
xlab("Average growing season temperature (C) June 1 - Sep 30")+
ylab("Actual Evapotranspiration")
ch2
#pch2<-ggplotly(ch2)
#pch2
#htmlwidgets::saveWidget(as_widget(pch2), "hwChapter/hydrology_2_temp_aet.html")
## Chapter 2.5
####################################################
# Forest cutting to increase water supply?
# WS5 clearcut in whole tree harvest 1984-1985.
head(annstr)
# separate out WS5
WS5<-annstr[annstr$WS=="W5",]
head(WS5)
# subset years for periof of time in question
harvest<-WS5[WS5$wyear >= "1970" & WS5$wyear <="1994" ,]
head(harvest)
# Use precip and stream discharge to evaluate effect on water yield and AET for 1983 (pre) - 1986 (post clear cut)
harvest$wyear<-as.integer(harvest$wyear)
gharv<-ggplot(harvest, aes(x=wyear, y=AET))+geom_point()+
geom_vline(xintercept=1983, linetype="dashed", col="red")+
geom_vline(xintercept=1985, linetype="solid", col="red")+
geom_line()+scale_x_continuous(limits = c(1970, 1994), breaks = seq(1970, 1994, 5))+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
xlab("Water year (June 1)")+
ylab("Actual Evapotranspiration")+
ggtitle("Hubbard Brook Watershed 5: Whole tree harvest 1983-1985")
gharv
# # a different look at the relationship
# ggplot(harvest, aes(x=Streamflow, y=Precip, col=wyear))+geom_point()+
#   theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
#   xlab("Streamflow (mm)")+
#   ylab("Precipitation (mm)")+
#   xlim(0,2000)+ylim(0,2000)
#pharv<-ggplotly(gharv)
#pharv
#htmlwidgets::saveWidget(as_widget(pharv), "hwChapter/hydrology_2_WS5_harvest.html")
w6biomass.kg.ha<-sum(trg$value) / 13.2
w6biomass.kg.ha<-sum(trg$value) / 13.2
w6biomass # kg of biomass per hectare
w6biomass.g.m2<- w6biomass.kg.ha * 1000 / 10000
# read in vegetation data for WS6 (received from Mary Martin 2022-06-29 by email)
dt7<-read.csv("C:\\Users\\bears\\Downloads\\HubbardBrookWS6_Tree_Biomass_1997.csv")
# Here is the structure of the input data frame:
str(dt7)
tr<-aggregate( list(abv=dt7$ABOVE.kg , blw=dt7$BELOW.kg), by=list(Plot=dt7$Plot, Sp=dt7$SppName), FUN="sum", na.rm=T)
dim(tr)
head(tr)
# gather above and below to make graphing easier
trg<-gather(tr, "abe","value", 3:4)
head(trg)
ggplot(trg, aes(x=Plot, y=value, fill=Sp))+geom_bar(stat="identity", position="stack", col="black")
## calculate the per area value of biomass on WS6 in 1974.
####  The planimetric area is 13.2 ha
sum(trg$value) # this is the biomass of the entire region?
w6biomass.kg.ha<-sum(trg$value) / 13.2
w6biomass.kg.ha # kg of biomass per hectare
w6biomass.g.m2<- w6biomass.kg.ha * 1000 / 10000
w6biomass.g.m2
w6ca.mg.ha<-3.13/1000 * w6biomass.g.m2
w6ca.mg.m2<-3.13/1000 * w6biomass.g.m2
w6biomass.g.m2
tr<-aggregate( list(abv=dt7$ABOVE.kg , blw=dt7$BELOW.kg), by=list(Plot=dt7$Plot, Sp=dt7$SppName), FUN="sum", na.rm=T)
dim(tr)
head(tr)
# gather above and below to make graphing easier
trg<-gather(tr, "abe","value", 3:4)
head(trg)
ggplot(trg, aes(x=Plot, y=value, fill=Sp))+geom_bar(stat="identity", position="stack", col="black")
####  The planimetric area is 13.2 ha
sum(trg$value) # this is the biomass of the entire region?
w6biomass.kg.ha<-sum(trg$value) / 13.2
w6biomass.kg.ha # kg of biomass per hectare
w6biomass.g.m2<- w6biomass.kg.ha * 1000 / 10000
w6biomass.g.m2
w6biomass.g.m2
w6ca.g.m2<-w6biomass.g.m2 * 0.00313 # grams Ca per gram of wood
w6ca.g.m2
70.4-50.7
70.4-50.7 / (50.7)
70.4-50.7
19.7/50.7
(70.4-50.7 ) / 50.7
head(str.obs, 20)
head(str.obs, 20)
head(str.obs, 11)
# bring complete years from str.obs to dt1
dt1$Use<-str.obs$Use[match(dt1$wys, str.obs$wys)]
dt1.complete<-dt1[dt1$Use=="complete",]
# calculate the annual sum of streamflow measurements
annstr<-aggregate(list(Streamflow=dt1.complete$Streamflow),
by=list(WS=dt1.complete$WS, wyear=dt1.complete$wyear), FUN="sum")
#  Make a streamflow graph
g1<-ggplot(annstr, aes(x=wyear, y=Streamflow, col=WS))+
geom_point()+geom_line()+
ylab("Steamflow (mm)")+xlab("Water year (June 1)")+
theme_bw()+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
g1
head(pre.obs, 50)
head(pre.obs, 50)
head(pre.obs, 11)
library(lubridate) # for handling date-times
library(ggplot2) # for visualizing
library(tidyr) # for data formatting
library(dplyr) # for data formatting
library(plotly)# for making interactive graphs
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
p1 # is now a plotly object
